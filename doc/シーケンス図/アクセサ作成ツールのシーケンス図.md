# AccessorCreationlToolシーケンス図

## 概要

このドキュメントは、`AbstractTwo2OneTool`クラスを起点としたアクセサ作成ツールのシーケンス図を提供します。このツールはJavaクラスのフィールドに対するアクセサメソッド（getterおよびsetter）を自動生成するためのツールで、入力ファイルとテンプレートファイルを使用して、アクセサメソッドを含む出力ファイルを生成します。

## シーケンス図

```mermaid
sequenceDiagram
    participant User as ユーザー
    participant ACT as AccessorCreationlTool
    participant AT2OT as AbstractTwo2OneTool
    participant AIT as AbstractIoTool
    participant ACService as AccessorCreationServiceImpl
    participant AIPS as AbstractIctoProcessorService
    participant ACLogic as AccessorCreationLogicImpl
    participant DtcService as DtcService
    participant Template as AccessorCreationlTool.yml
    participant Input as input.txt
    participant CSV as csv中間ファイル
    participant Output as output.txt

    User->>ACT: アプリケーション起動
    Note over ACT: main(String[] args)
    ACT->>ACT: SpringApplication.run

    ACT->>AT2OT: initialize()
    AT2OT->>ACService: initialize(inputPath, templatePath, outputPath)
    ACService->>AIPS: initialize(inputPath, templatePath, outputPath)
    AIPS->>AIPS: createTempCsvFile()

    ACT->>AIT: execute()
    AIT->>ACT: getIoService()
    ACT-->>AIT: accessorCreationService
    AIT->>ACService: process()
    ACService->>AIPS: process()
    AIPS->>ACService: writeCsvFile()

    ACService->>ACLogic: initialize(inputPath, csvPath)
    ACService->>ACLogic: addOneLineOfDataToCsvRows()

    loop 入力ファイル処理
        ACService->>ACLogic: readOneLineOfData()
        ACLogic-->>Input: ファイル読み込み

        ACService->>ACService: processColumns()

        ACService->>ACService: addNameColumn()
        ACService->>ACLogic: convertJavadoc()
        ACLogic->>ACLogic: Javadocコメント抽出処理
        ACService->>ACLogic: addJavadocCommentToCsvRows()
        ACLogic->>CSV: CSVにJavadocコメント追加

        ACService->>ACService: addRemainingColumns()
        ACService->>ACLogic: removeModifier()
        ACLogic->>ACLogic: 不要な修飾子を削除

        ACService->>ACLogic: convertFields()
        ACLogic->>ACLogic: フィールド情報抽出処理

        ACService->>ACLogic: addTypeToCsvRows()
        ACLogic->>CSV: CSVに型情報追加

        ACService->>ACLogic: addItemToCsvRows()
        ACLogic->>CSV: CSVに項目名追加

        ACService->>ACLogic: writeCsvFile()
        ACLogic->>CSV: CSVファイル書き込み

        ACService->>ACService: clearAndPrepareNextLine()
        ACService->>ACLogic: clearCsvRows()
        ACService->>ACLogic: clearProcessingData()
        ACService->>ACLogic: addOneLineOfDataToCsvRows()
    end

    AIPS->>DtcService: initialize(csvPath, templatePath, outputPath)
    AIPS->>DtcService: process()
    DtcService->>Template: テンプレート読み込み
    DtcService->>CSV: CSV読み込み

    loop テンプレート適用処理
        DtcService->>DtcService: readOneLineData()
        DtcService->>DtcService: applyTemplateToInputFile()
        DtcService->>DtcService: addOutputBufferContent()
        DtcService->>DtcService: writeOutputBuffer()
        DtcService->>DtcService: clearOutputBufferContent()
    end

    DtcService->>Output: 出力ファイル生成

    ACService->>ACLogic: close()
    ACLogic->>ACLogic: closeReader()
    ACLogic->>ACLogic: closeWriter()

    ACT-->>User: 処理完了
```

## 処理フロー詳細

1. ユーザーがアプリケーションを起動
2. SpringBootアプリケーションが起動し、AccessorCreationlToolのインスタンスが生成される
3. AbstractTwo2OneToolのinitialize()メソッドが呼び出され、AccessorCreationServiceが初期化される
4. AbstractIoToolのexecute()メソッドが呼び出され、メイン処理が実行される
5. AccessorCreationServiceImplのwriteCsvFile()メソッドが実行され、入力ファイルの処理が開始される
6. 入力ファイルから1行ずつデータを読み込み、以下の処理を行う：
   - Javadocコメントの抽出と変換
   - 不要な修飾子（finalやstatic）の削除
   - フィールド定義から型情報と項目名の抽出
   - CSV形式に変換して中間ファイルに書き込み
7. 中間ファイル（CSV）の生成が完了したら、DtcService（テンプレートの動的変換サービス）を使用して：
   - テンプレートファイル（AccessorCreationlTool.yml）を読み込む
   - 中間ファイル（CSV）のデータを読み込む
   - テンプレートにデータを適用して出力ファイルを生成する
8. リソースがクローズされ、処理が完了する

## 主要コンポーネント

### AccessorCreationlTool

- SpringBootApplicationとして動作するエントリーポイント
- AbstractDynamicTemplateConversionToolを継承（さらにAbstractTwo2OneToolを継承）
- AccessorCreationServiceを使用してアクセサ生成を実行

### AbstractTwo2OneTool

- AbstractIoToolを継承
- テンプレートファイルパスの管理と初期化処理を担当

### AccessorCreationServiceImpl

- AbstractIctoProcessorServiceを継承
- AccessorCreationServiceインターフェースを実装
- 入力ファイルの読み込みとCSV形式への変換を担当

### AccessorCreationLogicImpl

- アクセサ作成の実際のロジックを担当
- フィールド定義からアクセサメソッドに必要な情報を抽出
- CSV形式の中間ファイルを生成

### DtcService（テンプレートの動的変換サービス）

- テンプレートファイルとCSVデータを使用して最終的な出力ファイルを生成
- プレースホルダの置換処理を担当

### テンプレートファイル（AccessorCreationlTool.yml）

- getterとsetterのテンプレートを定義
- 以下のプレースホルダを使用：
  - {name}：フィールドの名称（Javadocコメント）
  - {type}：フィールドの型
  - {item}：フィールド名
  - {Item}：先頭大文字のフィールド名

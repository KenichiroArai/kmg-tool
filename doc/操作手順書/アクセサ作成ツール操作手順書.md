# アクセサ作成ツール操作手順書

## 1. 概要

アクセサ作成ツールは、Java クラスのフィールド定義からアクセサメソッド（getter および setter）を自動生成するためのツールである。

### 主な機能

- フィールド定義からアクセサメソッドの自動生成
- テンプレートベースの柔軟な出力形式
- Javadoc コメントの自動付与
- 中間ファイルを経由した安全な処理

## 2. ファイル配置

### 2.1 ディレクトリ構造

```text
kmg-tool/
├── work/io/                          # 優先パス（開発時推奨）
│   ├── input.txt                     # 入力ファイル
│   ├── output.txt                    # 出力ファイル
│   └── template/
│       └── AccessorCreationTool.yml  # テンプレートファイル
└── src/main/resources/tool/io/       # 代替パス
    ├── input.txt                     # 入力ファイル
    ├── output.txt                    # 出力ファイル
    └── template/
        └── AccessorCreationTool.yml  # テンプレートファイル
```

### 2.2 ファイルパスの優先順位

1. **優先パス**: `work/io/` ディレクトリが存在する場合
2. **代替パス**: `work/io/` ディレクトリが存在しない場合、`src/main/resources/tool/io/` を使用

## 3. 入力ファイルの準備

### 3.1 入力ファイル形式

入力ファイル（`input.txt`）は以下の形式でフィールド定義を記述する：

```text
コメント フィールド名 データ型
```

### 3.2 入力ファイル例

```text
ユーザーID user_id String
ユーザー名 user_name String
年齢 age int
作成日時 created_at java.time.LocalDateTime
```

### 3.3 入力ファイルの注意事項

- 各行は「コメント フィールド名 データ型」の形式で記述する
- フィールド名はキャメルケースで記述する（例：`userId`）
- データ型は完全修飾名または短縮名で記述可能である
- 空行は無視される
- コメントは日本語でも英語でも可である

## 4. テンプレートファイルの設定

### 4.1 テンプレートファイルの場所

- **優先パス**: `work/io/template/AccessorCreationTool.yml`
- **代替パス**: `src/main/resources/tool/io/template/AccessorCreationTool.yml`

### 4.2 テンプレートファイルの構造

```yaml
# 中間から直接取得するプレースホルダー定義
intermediatePlaceholders:
  - displayName: "名称"
    replacementPattern: "{name}"
  - displayName: "型"
    replacementPattern: "{type}"
  - displayName: "項目"
    replacementPattern: "{item}"

# 中間から取得した値を変換して生成するプレースホルダー定義
derivedPlaceholders:
  - displayName: "先頭大文字項目"
    replacementPattern: "{capitalize}"
    sourceKey: "項目"
    transformation: "capitalize"

# テンプレートの内容
templateContent: |
  /**
   * {name}を設定する<br>
   * @author KenichiroArai
   * @since 0.1.0
   * @param {item} {name}
   */
  public void set{capitalize}({type} {item}) {
      this.{item} = {item};
  }

  /**
   * {name}を返す<br>
   * @author KenichiroArai
   * @since 0.1.0
   * @return {name}
   */
  public {type} get{capitalize}() {
      {type} result = this.{item};
      return result;
  }
```

### 4.3 プレースホルダーの説明

| プレースホルダー | 説明                           | 例           |
| ---------------- | ------------------------------ | ------------ |
| `{name}`         | フィールドのコメント           | `ユーザーID` |
| `{type}`         | フィールドのデータ型           | `String`     |
| `{item}`         | フィールド名（キャメルケース） | `userId`     |
| `{capitalize}`   | 先頭大文字のフィールド名       | `UserId`     |

## 5. 実行手順

### 5.1 基本的な実行方法

1. **入力ファイルの準備**

   ```bash
   # work/ioディレクトリを作成（存在しない場合）
   mkdir -p work/io

   # 入力ファイルを作成
   echo "ユーザーID userId String" > work/io/input.txt
   echo "ユーザー名 userName String" >> work/io/input.txt
   echo "年齢 age int" >> work/io/input.txt
   ```

2. **テンプレートファイルの配置**

   ```bash
   # テンプレートディレクトリを作成
   mkdir -p work/io/template

   # テンプレートファイルをコピー
   cp src/main/resources/tool/io/template/AccessorCreationTool.yml work/io/template/
   ```

3. **ツールの実行**

   ```bash
   # Mavenを使用して実行
   mvn exec:java -Dexec.mainClass="kmg.tool.acccrt.presentation.ul.cli.AccessorCreationTool"

   # または、JARファイルから実行
   java -cp target/classes:target/dependency/* kmg.tool.acccrt.presentation.ul.cli.AccessorCreationTool
   ```

### 5.2 コマンドライン引数

現在のバージョンでは、コマンドライン引数は使用されない。ファイルパスは自動的に決定される。

### 5.3 実行時のログ出力

実行時には以下のようなログが出力される：

```text
[INFO] アクセサ作成ツール開始
[INFO] 入力ファイル: work/io/input.txt
[INFO] テンプレートファイル: work/io/template/AccessorCreationTool.yml
[INFO] 出力ファイル: work/io/output.txt
[INFO] 処理完了: 3件のフィールドを処理しました
[INFO] アクセサ作成ツール終了
```

## 6. 出力ファイルの確認

### 6.1 出力ファイルの場所

- **優先パス**: `work/io/output.txt`
- **代替パス**: `src/main/resources/tool/io/output.txt`

### 6.2 出力例

入力ファイルの例に対して、以下のような出力が生成される：

```java
/**
 * ユーザーIDを設定する<br>
 * @author KenichiroArai
 * @since 0.1.0
 * @param userId ユーザーID
 */
public void setUserId(String userId) {
    this.userId = userId;
}

/**
 * ユーザーIDを返す<br>
 * @author KenichiroArai
 * @since 0.1.0
 * @return ユーザーID
 */
public String getUserId() {
    String result = this.userId;
    return result;
}

/**
 * ユーザー名を設定する<br>
 * @author KenichiroArai
 * @since 0.1.0
 * @param userName ユーザー名
 */
public void setUserName(String userName) {
    this.userName = userName;
}

/**
 * ユーザー名を返す<br>
 * @author KenichiroArai
 * @since 0.1.0
 * @return ユーザー名
 */
public String getUserName() {
    String result = this.userName;
    return result;
}

/**
 * 年齢を設定する<br>
 * @author KenichiroArai
 * @since 0.1.0
 * @param age 年齢
 */
public void setAge(int age) {
    this.age = age;
}

/**
 * 年齢を返す<br>
 * @author KenichiroArai
 * @since 0.1.0
 * @return 年齢
 */
public int getAge() {
    int result = this.age;
    return result;
}
```

## 7. トラブルシューティング

### 7.1 よくあるエラーと対処法

#### エラー: 入力ファイルが見つからない

```text
[ERROR] 入力ファイルが見つかりません: work/io/input.txt
```

**対処法**:

- 入力ファイルが正しい場所に配置されているか確認
- ファイル名が `input.txt` になっているか確認
- ファイルの読み取り権限があるか確認

#### エラー: テンプレートファイルが見つからない

```text
[ERROR] テンプレートファイルが見つかりません: work/io/template/AccessorCreationTool.yml
```

**対処法**:

- テンプレートファイルが正しい場所に配置されているか確認
- ファイル名が `AccessorCreationTool.yml` になっているか確認
- YAML ファイルの構文が正しいか確認

#### エラー: 入力ファイルの形式が正しくない

```text
[ERROR] 行番号 3: フィールド定義の形式が正しくありません
```

**対処法**:

- 入力ファイルの各行が「コメント フィールド名 データ型」の形式になっているか確認
- 空行や不正な文字が含まれていないか確認

### 7.2 ログファイルの確認

詳細なエラー情報は以下のログファイルで確認できる：

- `logs/kmg-tool/kmg-tool.log`
- `logs/exceptions/kmg-core-exceptions.log`

## 8. カスタマイズ

### 8.1 テンプレートのカスタマイズ

テンプレートファイルを編集することで、出力形式をカスタマイズできる：

```yaml
templateContent: |
  /**
   * {name}を設定する
   * @param {item} {name}
   */
  public void set{capitalize}({type} {item}) {
      this.{item} = {item};
  }

  /**
   * {name}を取得する
   * @return {name}
   */
  public {type} get{capitalize}() {
      return this.{item};
  }
```

### 8.2 プレースホルダーの追加

必要に応じて、新しいプレースホルダーを追加できる：

```yaml
derivedPlaceholders:
  - displayName: "先頭大文字項目"
    replacementPattern: "{capitalize}"
    sourceKey: "項目"
    transformation: "capitalize"
  - displayName: "小文字項目"
    replacementPattern: "{lowercase}"
    sourceKey: "項目"
    transformation: "lowercase"
```

## 9. 処理フロー

### 9.1 処理の流れ

1. **初期化**: 入力ファイル、テンプレートファイル、出力ファイルのパスを決定
2. **入力ファイル読み込み**: フィールド定義を 1 行ずつ読み込み
3. **中間ファイル生成**: フィールド情報を中間ファイル形式に変換
4. **テンプレート適用**: テンプレートにデータを適用してアクセサメソッドを生成
5. **出力ファイル書き込み**: 生成されたアクセサメソッドを出力ファイルに書き込み

### 9.2 データ変換処理

- **フィールド名**: キャメルケース形式で保持
- **データ型**: 完全修飾名から短縮名への変換
- **コメント**: そのまま保持
- **先頭大文字変換**: フィールド名の先頭を大文字に変換

## 10. 注意事項

### 10.1 ファイルの上書き

- 出力ファイルが既に存在する場合、内容が上書きされる
- 重要なファイルは事前にバックアップを取ることを推奨する

### 10.2 文字エンコーディング

- 入力ファイル、テンプレートファイル、出力ファイルはすべて UTF-8 エンコーディングで処理される
- 日本語コメントを含む場合は、UTF-8 で保存すること

### 10.3 パフォーマンス

- 大量のフィールド定義を処理する場合、処理時間が長くなる可能性がある
- 必要に応じて、入力ファイルを分割して処理することを検討すること

## 11. 関連ツール

- **フィールド作成ツール**: データベースフィールド定義から Java フィールド定義を生成
- **インタフェースアクセサ作成ツール**: インタフェース用のアクセサメソッドを生成
- **Javadoc タグ設定ツール**: 既存の Java ファイルに Javadoc タグを自動設定

# 挿入 SQL 作成ツール操作手順書

## 1. 概要

挿入 SQL 作成ツールは、Excel ファイルのデータシートから INSERT 文（挿入 SQL）を自動生成するための GUI ツールである。

### 主な機能

- Excel ファイルから INSERT 文の自動生成
- 複数シートの並列処理による高速処理
- データベース型に応じた値のフォーマット処理
- テーブルごとの SQL ファイル出力
- GUI 画面による直感的な操作

## 2. ファイル配置

### 2.1 ディレクトリ構造

```text
kmg-tool/
├── src/main/java/kmg/tool/is/                    # 挿入SQL作成ツール本体
│   ├── presentation/ui/gui/
│   │   ├── IsCreationTool.java                   # メインクラス（エントリポイント）
│   │   └── controller/
│   │       └── IsCreationController.java         # GUIコントローラ
│   ├── application/service/
│   │   ├── IsCreationService.java                # サービスインタフェース
│   │   ├── IsFileCreationService.java            # ファイル処理サービス
│   │   └── impl/                                 # サービス実装
│   └── application/logic/                        # ビジネスロジック
└── src/main/resources/
    └── kmg/tool/application/ui/gui/
        └── IsCreationScreenGui.fxml              # GUI画面定義
```

### 2.2 入出力ファイル配置

- **入力ファイル**: ユーザーが GUI 画面で選択する Excel ファイル（任意の場所）
- **出力ディレクトリ**: ユーザーが GUI 画面で選択するディレクトリ（任意の場所）
- **出力ファイル**: 選択したディレクトリ内にテーブルごとの SQL ファイルを生成

## 3. 入力ファイルの準備

### 3.1 入力ファイル形式

入力ファイルは Microsoft Excel ファイル（.xlsx 形式）で、以下の構成が必要である：

- **設定シート**: ツール全体の設定情報
- **一覧シート**: シート一覧情報
- **データシート**: 実際のデータが格納されたシート（複数可）

### 3.2 設定シートの構成

設定シートには以下の情報を記載する：

| 項目          | 説明                                        |
| ------------- | ------------------------------------------- |
| KMG DB の種類 | データベースの種類（PostgreSQL、Oracle 等） |
| SQL ID マップ | SQL 識別子のマッピング情報                  |

### 3.3 データシートの構成

各データシートは以下の構成で作成する：

1. **テーブル情報行**

   - 論理テーブル名
   - 物理テーブル名
   - SQL ID

2. **カラム定義行**

   - 物理カラム名
   - データ型情報

3. **データ行**
   - 実際に挿入するデータ

### 3.4 入力ファイル例

```text
[設定シート]
KMG DBの種類: PostgreSQL
SQL IDマップ: {...}

[データシート例: USER_MASTER]
論理テーブル名: ユーザーマスタ
物理テーブル名: USER_MASTER
SQL ID: USR001

物理カラム名 | データ型
USER_ID     | VARCHAR(10)
USER_NAME   | VARCHAR(50)
CREATE_DATE | TIMESTAMP

データ行:
USER001 | 山田太郎 | 2024-01-01 10:00:00
USER002 | 佐藤花子 | 2024-01-02 11:00:00
```

### 3.5 入力ファイルの注意事項

- Excel ファイルは.xlsx 形式で作成する
- データシート名は任意だが、「設定」「一覧」は予約語として使用しない
- データ型はデータベースに応じて適切に設定する
- 空行は無視される
- 日時データは適切なフォーマットで入力する

## 4. 実行手順

### 4.1 基本的な実行方法

1. **アプリケーションの起動**

   ```bash
   # Mavenを使用して実行
   mvn exec:java -Dexec.mainClass="kmg.tool.is.presentation.ui.gui.IsCreationTool"

   # または、JARファイルから実行
   java -cp target/classes:target/dependency/* kmg.tool.is.presentation.ui.gui.IsCreationTool
   ```

2. **GUI 画面での操作**

   アプリケーションが起動すると「挿入 SQL 作成画面」が表示される。

3. **入力ファイルの選択**

   - 「入力ファイル：」の横にある「ファイルを開く」ボタンをクリック
   - ファイル選択ダイアログが表示される
   - 処理対象の Excel ファイルを選択
   - 選択されたファイルパスがテキストボックスに表示される

4. **出力ディレクトリの選択**

   - 「出力ディレクトリ：」の横にある「ディレクトリを開く」ボタンをクリック
   - ディレクトリ選択ダイアログが表示される
   - SQL ファイルを出力するディレクトリを選択
   - 選択されたディレクトリパスがテキストボックスに表示される

5. **スレッド数の設定（オプション）**

   - デフォルトでは CPU の論理プロセッサ数が設定される
   - 必要に応じてスレッド数を変更可能
   - 並列処理のパフォーマンスに影響する

6. **実行処理**

   - 「実行」ボタンをクリック
   - 処理が開始され、進行状況がログに出力される
   - 処理完了後、処理時間が画面に表示される

### 4.2 GUI 画面の構成

```text
┌─────────────────────────────────────────────────────────────┐
│ 挿入SQL作成画面                                              │
├─────────────────────────────────────────────────────────────┤
│ 入力ファイル：    [ファイルパス表示欄]     [ファイルを開く]   │
│ 出力ディレクトリ：[ディレクトリパス表示欄] [ディレクトリを開く]│
│ 処理時間：[時間] [単位]  スレッド数：[数値]                   │
│                      [実行]                                 │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 実行時のログ出力

実行時には以下のようなログが出力される：

```text
[INFO] 挿入SQL作成ツール開始
[INFO] 入力ファイル: C:\data\input.xlsx
[INFO] 出力ディレクトリ: C:\output\
[INFO] スレッド数: 8
[INFO] シート処理開始: USER_MASTER
[INFO] シート処理完了: USER_MASTER (処理時間: 0.5秒)
[INFO] シート処理開始: PRODUCT_MASTER
[INFO] シート処理完了: PRODUCT_MASTER (処理時間: 0.3秒)
[INFO] 全シート処理完了
[INFO] 挿入SQL作成ツール終了 (総処理時間: 1.2秒)
```

## 5. 出力ファイルの確認

### 5.1 出力ファイルの場所

- 指定した出力ディレクトリ内にテーブルごとの SQL ファイルが生成される
- ファイル名形式: `{テーブル物理名}.sql`

### 5.2 出力ファイルの構成

各 SQL ファイルには以下の内容が出力される：

1. **削除 SQL（DELETE 文）**

   - テーブルの既存データを削除
   - 条件なしの全件削除

2. **挿入 SQL（INSERT 文）**
   - データシートの各行に対応する INSERT 文
   - データ型に応じた適切な値のフォーマット

### 5.3 出力例

入力ファイルの例に対して、以下のような SQL ファイルが生成される：

**ファイル名**: `USER_MASTER.sql`

```sql
-- =====================================================
-- テーブル: USER_MASTER (ユーザーマスタ)
-- SQL ID: USR001
-- 生成日時: 2024-01-15 14:30:00
-- =====================================================

-- 既存データ削除
DELETE FROM USER_MASTER;

-- データ挿入
INSERT INTO USER_MASTER (USER_ID, USER_NAME, CREATE_DATE) VALUES ('USER001', '山田太郎', '2024-01-01 10:00:00');
INSERT INTO USER_MASTER (USER_ID, USER_NAME, CREATE_DATE) VALUES ('USER002', '佐藤花子', '2024-01-02 11:00:00');

-- 処理完了
```

### 5.4 データ型別のフォーマット例

| データ型  | 入力例              | 出力例                |
| --------- | ------------------- | --------------------- |
| VARCHAR   | 山田太郎            | '山田太郎'            |
| INTEGER   | 123                 | 123                   |
| DECIMAL   | 123.45              | 123.45                |
| TIMESTAMP | 2024-01-01 10:00:00 | '2024-01-01 10:00:00' |
| BOOLEAN   | true                | true                  |
| NULL      | (空欄)              | NULL                  |
